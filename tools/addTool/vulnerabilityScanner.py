import aiohttp
import asyncio
import re
import os
import aiofiles  # 추가된 임포트
from urllib.parse import urljoin

common_vulnerabilities = [
    "admin.php", "login.php", "config.php", "index.php", "dashboard.php",
    "user.php", "register.php", "forgot_password.php", "reset.php",
    "upload.php", "file_manager.php", "backup.php", "db_admin.php",
    "admin/login.php", "admin/dashboard.php", "cpanel.php",
    ".env", "wp-admin", "wp-login.php", "phpinfo.php",
    ".git/config", ".htaccess", ".htpasswd", "setup.php", "install.php",
    "admin/index.php", "admin/panel.php", "admin_area/admin.php", "admin_area/login.php",
    "admin_area/index.php", "admin_area/dashboard.php", "admin_area/panel.php",
    "administrator/index.php", "administrator/login.php", "administrator/account.php",
    "administrator.php", "admin1.php", "admin2.php", "admin3.php", "admin4.php",
    "admin5.php", "usuarios.php", "user.php", "administrator/", "admin1/", "admin2/",
    "admin3/", "admin4/", "admin5/", "usuarios/", "user/", "administrator/login.php",
    "administrator/account.php", "administrator.php", "admin_area/admin.html",
    "admin_area/login.html", "admin_area/index.html", "admin_area/dashboard.html",
    "admin_area/panel.html", "administrator/index.html", "administrator/login.html",
    "administrator/account.html", "administrator.html", "admin1.html", "admin2.html",
    "admin3.html", "admin4.html", "admin5.html", "usuarios.html", "user.html",
    "administrator/", "admin1/", "admin2/", "admin3/", "admin4/", "admin5/",
    "usuarios/", "user/", "administrator/login.html", "administrator/account.html",
    "administrator.html", "admin_area/admin.asp", "admin_area/login.asp",
    "admin_area/index.asp", "admin_area/dashboard.asp", "admin_area/panel.asp",
    "administrator/index.asp", "administrator/login.asp", "administrator/account.asp",
    "administrator.asp", "admin1.asp", "admin2.asp", "admin3.asp", "admin4.asp",
    "admin5.asp", "usuarios.asp", "user.asp", "administrator/", "admin1/", "admin2/",
    "admin3/", "admin4/", "admin5/", "usuarios/", "user/", "administrator/login.asp",
    "administrator/account.asp", "administrator.asp",
    "admin.js", "login.js", "config.js", "index.js", "dashboard.js",
    "user.js", "register.js", "forgot_password.js", "reset.js",
    "upload.js", "file_manager.js", "backup.js", "db_admin.js",
    "admin/login.js", "admin/dashboard.js", "cpanel.js",
    "admin/index.js", "admin/panel.js", "admin_area/admin.js", "admin_area/login.js",
    "admin_area/index.js", "admin_area/dashboard.js", "admin_area/panel.js",
    "administrator/index.js", "administrator/login.js", "administrator/account.js",
    "administrator.js", "admin1.js", "admin2.js", "admin3.js", "admin4.js",
    "admin5.js", "usuarios.js", "user.js", "administrator/", "admin1/", "admin2/",
    "admin3/", "admin4/", "admin5/", "usuarios/", "user/", "administrator/login.js",
    "administrator/account.js", "administrator.js",
    "admin.css", "login.css", "config.css", "index.css", "dashboard.css",
    "user.css", "register.css", "forgot_password.css", "reset.css",
    "upload.css", "file_manager.css", "backup.css", "db_admin.css",
    "admin/login.css", "admin/dashboard.css", "cpanel.css",
    "admin/index.css", "admin/panel.css", "admin_area/admin.css", "admin_area/login.css",
    "admin_area/index.css", "admin_area/dashboard.css", "admin_area/panel.css",
    "administrator/index.css", "administrator/login.css", "administrator/account.css",
    "administrator.css", "admin1.css", "admin2.css", "admin3.css", "admin4.css",
    "admin5.css", "usuarios.css", "user.css", "administrator/", "admin1/", "admin2/",
    "admin3/", "admin4/", "admin5/", "usuarios/", "user/", "administrator/login.css",
    "administrator/account.css", "administrator.css",
    "admin.xml", "login.xml", "config.xml", "index.xml", "dashboard.xml",
    "user.xml", "register.xml", "forgot_password.xml", "reset.xml",
    "upload.xml", "file_manager.xml", "backup.xml", "db_admin.xml",
    "admin/login.xml", "admin/dashboard.xml", "cpanel.xml",
    "admin/index.xml", "admin/panel.xml", "admin_area/admin.xml", "admin_area/login.xml",
    "admin_area/index.xml", "admin_area/dashboard.xml", "admin_area/panel.xml",
    "administrator/index.xml", "administrator/login.xml", "administrator/account.xml",
    "administrator.xml", "admin1.xml", "admin2.xml", "admin3.xml", "admin4.xml",
    "admin5.xml", "usuarios.xml", "user.xml", "administrator/", "admin1/", "admin2/",
    "admin3/", "admin4/", "admin5/", "usuarios/", "user/", "administrator/login.xml",
    "administrator/account.xml", "administrator.xml",
    "admin.png", "login.png", "config.png", "index.png", "dashboard.png",
    "user.png", "register.png", "forgot_password.png", "reset.png",
    "upload.png", "file_manager.png", "backup.png", "db_admin.png",
    "admin/login.png", "admin/dashboard.png", "cpanel.png",
    "admin/index.png", "admin/panel.png", "admin_area/admin.png", "admin_area/login.png",
    "admin_area/index.png", "admin_area/dashboard.png", "admin_area/panel.png",
    "administrator/index.png", "administrator/login.png", "administrator/account.png",
    "administrator.png", "admin1.png", "admin2.png", "admin3.png", "admin4.png",
    "admin5.png", "usuarios.png", "user.png", "administrator/", "admin1/", "admin2/",
    "admin3/", "admin4/", "admin5/", "usuarios/", "user/", "administrator/login.png",
    "administrator/account.png", "administrator.png",
    "admin.jpg", "login.jpg", "config.jpg", "index.jpg", "dashboard.jpg",
    "user.jpg", "register.jpg", "forgot_password.jpg", "reset.jpg",
    "upload.jpg", "file_manager.jpg", "backup.jpg", "db_admin.jpg",
    "admin/login.jpg", "admin/dashboard.jpg", "cpanel.jpg",
    "admin/index.jpg", "admin/panel.jpg", "admin_area/admin.jpg", "admin_area/login.jpg",
    "admin_area/index.jpg", "admin_area/dashboard.jpg", "admin_area/panel.jpg",
    "administrator/index.jpg", "administrator/login.jpg", "administrator/account.jpg",
    "administrator.jpg", "admin1.jpg", "admin2.jpg", "admin3.jpg", "admin4.jpg",
    "admin5.jpg", "usuarios.jpg", "user.jpg", "administrator/", "admin1/", "admin2/",
    "admin3/", "admin4/", "admin5/", "usuarios/", "user/", "administrator/login.jpg",
    "administrator/account.jpg", "administrator.jpg",
    "admin.mp3", "login.mp3", "config.mp3", "index.mp3", "dashboard.mp3",
    "user.mp3", "register.mp3", "forgot_password.mp3", "reset.mp3",
    "upload.mp3", "file_manager.mp3", "backup.mp3", "db_admin.mp3",
    "admin/login.mp3", "admin/dashboard.mp3", "cpanel.mp3",
    "admin/index.mp3", "admin/panel.mp3", "admin_area/admin.mp3", "admin_area/login.mp3",
    "admin_area/index.mp3", "admin_area/dashboard.mp3", "admin_area/panel.mp3",
    "administrator/index.mp3", "administrator/login.mp3", "administrator/account.mp3",
    "administrator.mp3", "admin1.mp3", "admin2.mp3", "admin3.mp3", "admin4.mp3",
    "admin5.mp3", "usuarios.mp3", "user.mp3", "administrator/", "admin1/", "admin2/",
    "admin3/", "admin4/", "admin5/", "usuarios/", "user/", "administrator/login.mp3",
    "administrator/account.mp3", "administrator.mp3",
    "admin.webp", "login.webp", "config.webp", "index.webp", "dashboard.webp",
    "user.webp", "register.webp", "forgot_password.webp", "reset.webp",
    "upload.webp", "file_manager.webp", "backup.webp", "db_admin.webp",
    "admin/login.webp", "admin/dashboard.webp", "cpanel.webp",
    "admin/index.webp", "admin/panel.webp", "admin_area/admin.webp", "admin_area/login.webp",
    "admin_area/index.webp", "admin_area/dashboard.webp", "admin_area/panel.webp",
    "administrator/index.webp", "administrator/login.webp", "administrator/account.webp",
    "administrator.webp", "admin1.webp", "admin2.webp", "admin3.webp", "admin4.webp",
    "admin5.webp", "usuarios.webp", "user.webp", "administrator/", "admin1/", "admin2/",
    "admin3/", "admin4/", "admin5/", "usuarios/", "user/", "administrator/login.webp",
    "administrator/account.webp", "administrator.webp"
]

async def save_results(results):
    os.makedirs('vulnerabilityScanner', exist_ok=True)
    async with aiofiles.open('vulnerabilityScanner/results.txt', 'w') as file:
        for line in results:
            await file.write(line + "\n")
    print("[+] Results saved in 'vulnerabilityScanner/results.txt'")

async def scan_vulnerability(session, target_url, vuln, results):
    url = urljoin(target_url.rstrip('/'), vuln)
    try:
        async with session.get(url, timeout=5) as response:
            if response.status == 200:
                result = f"[+] Found: {url}"
                results.append(result)
                print(result)
            elif response.status == 403:
                result = f"[!] Forbidden: {url}"
                results.append(result)
                print(result)
            else:
                result = f"[-] Not Found: {url}"
                results.append(result)
                print(result)
    except aiohttp.ClientError as e:
        result = f"[-] Error scanning {url}: {e}"
        results.append(result)
        print(result)

async def vulnerability_scanner(target_url):
    results = []
    async with aiohttp.ClientSession() as session:
        tasks = [scan_vulnerability(session, target_url, vuln, results) for vuln in common_vulnerabilities]
        await asyncio.gather(*tasks)
    return results

async def main():
    target_url = input("Enter the target URL (https or http required, e.g., https://example.com): ").strip()

    url_pattern = re.compile(r'^(http://|https://)([a-zA-Z0-9.-]+)(:[0-9]+)?(/.*)?$')
    if not url_pattern.match(target_url):
        print("[-] Invalid URL. Please include 'http://' or 'https://' and a valid domain.")
        return

    results = await vulnerability_scanner(target_url)

    save_results_choice = input("Do you want to save the results? (Y/N): ").strip().lower()
    if save_results_choice == 'y':
        await save_results(results)
    else:
        print("[-] Results not saved.")

if __name__ == "__main__":
    asyncio.run(main())